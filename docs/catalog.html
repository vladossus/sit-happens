<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sit Happens | Каталог</title>
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/product.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background-color: #333;
        }
        .search-container {
            width:fit-content;
            margin: auto;
            padding-bottom: 4px;
            margin-top: 1rem;
            display: flex;
            justify-content: center;
            border-bottom: 2px solid #ccc;
        }
        .search-container .search-icon {
            color: #ccc;
            margin-right: 1rem;
        }
        #search-input {
            font-size: medium;
            color: #ccc;
            background: none;
            border: none;
        }
        #search-input:focus{
            outline: none;
        }
        .catalog-container {
            padding: 0.5rem;
            display: flex;
            flex-wrap: wrap;
            flex-direction: row;
        }
        .catalog-container .product-card {
            margin: 1rem;
        }
    </style>
</head>
<body>
    <!-- header -->
    <header>
        <img src="assets/logo.png" alt="SH" class="logo">      
        <nav>
            <ul>
                <li><a href="index.html">Главная</a></li>
                <li><a href="catalog.html" style="color: #8b5a2b;">Каталог</a></li>
                <li><a href="restoration.html">Реставрация</a></li>
            </ul>
        </nav>
        <div class="user-actions">
            <!-- logged out -->
            <div class="logged-out-only">
                <button class="logout-button btn-secondary" onclick="LoginForm.show()">Войти</button>
                <button class="signup-button btn-primary" onclick="RegisterForm.show()">Создать аккаунт</button>
            </div>
            <!-- logged in -->
            <div class="logged-in-only header-service">
                <span>Привет, <strong style="color:#333" id="username">Пользователь</strong>!</span>
                <button class="logout-button btn-secondary" onclick="Cart.clear();updateCartCounter();Auth.logout()">Выйти</button>
                <a href="cart.html" class="cart-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                    <span id="cart-count">0</span>
                </a>
            </div>
        </div>
    </header>
    <div class="search-container">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="28" height="28" viewBox="0 0 24 24">
            <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,
            14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,
            12 14,9.5C14,7 12,5 9.5,5Z" />
        </svg>
        <input type="text" id="search-input" placeholder="Поиск по каталогу"/>
    </div>
    <div id="product-container" class="catalog-container"/>
    <!-- scripts -->
    <script src="js/auth.js"></script>
    <script src="js/catalog.js"></script>
    <script src="js/cart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () =>
        {
            const search = document.getElementById('search-input');
            const container = document.getElementById('product-container');
            function showProducts(products)
            {
                container.innerHTML = '';
                products.forEach(product => {
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.dataset.id = product.id;
                    card.innerHTML = `
                        <img class="product-image" src="products/${product.id}.jpg" alt="${product.name}">
                        <div class="product-info">
                            <h3 class="product-name">${product.name}</h3>
                            <p class="product-description">${product.description}</p>
                            <div class="product-bottom">
                                <span class="product-price">${product.price.toLocaleString('en-US')} &#1089;</span>
                                <button class="btn-primary cart-add">В корзину</button>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
            search.addEventListener('input', () =>
            {
                const searchQuery = search.value.toLowerCase();
                const filteredProducts = catalog.filter(product => 
                {
                    return product.name.toLowerCase().includes(searchQuery);
                });
                showProducts(filteredProducts);
            });
            showProducts(catalog);
            container.addEventListener('click', (event) => {
                if (event.target.classList.contains('cart-add')) {
                    const card = event.target.closest('.product-card');
                    const productId = parseInt(card.dataset.id);
                    const product = catalog.find(p => p.id === productId);
                    if (product) {
                        Cart.addItem(product);
                        updateCartCounter();
                    }
                }
            });
            updateCartCounter();
        });
    </script>
</body>
</html>